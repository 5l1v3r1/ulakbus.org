<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width" charset="utf-8">
    <title>Ulakbus UI</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/cayman.min.css">
    <link rel="stylesheet" href="css/prism.min.css">
    <link rel="stylesheet" href="css/index.min.css">
    <link rel="stylesheet" href="css/docs.min.css">
    <link rel="stylesheet" href="css/bootstrap-responsive.min.css">
  </head>
  <body data-spy="scroll" data-target=".scrollspy">
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container"><a class="brand">Mr. Doc</a>
          <div class="nav-collapse collapse">
            <ul class="nav pull-right sponsored"></ul>
          </div>
        </div>
      </div>
    </div>
    <header id="overview" class="jumbotron subhead">
      <div class="container">
        <h1>Ulakbus UI</h1>
        <p class="lead"></p>
      </div>
    </header>
    <div class="container">
      <div class="row">
        <div class="span3 bs-docs-sidebar">
          <ul class="nav nav-list bs-docs-sidenav affix-top">
            <li><a href="index.html">Main</a></li>
            <li><a href="app.js.html">app.js</a></li>
            <li><a href="auth_controller.js.html">auth_controller.js</a></li>
            <li><a href="auth_service.js.html">auth_service.js</a></li>
            <li><a href="crud_controller.js.html">crud_controller.js</a></li>
            <li><a href="directives.js.html">directives.js</a></li>
            <li class="active"><a href="form_service.js.html">form_service.js</a></li>
            <li><a href="interceptors.js.html">interceptors.js</a></li>
          </ul>
          <div class="scrollspy">
            <ul class="nav nav-list bs-docs-sidenav affix-top">
              <li><a href="#makeUrl"><i class="alert alert-info"></i><span>makeUrl</span></a>
              </li>
              <li><a href="#generate"><i class="alert alert-info"></i><span>generate</span></a>
              </li>
              <li><a href="#group"><i class="alert alert-info"></i><span>group</span></a>
              </li>
              <li><a href="#prepareFormItems"><i class="alert alert-info"></i><span>prepareFormItems</span></a>
              </li>
              <li><a href="#dateformatter"><i class="alert alert-info"></i><span>dateformatter</span></a>
              </li>
              <li><a href="#doItemAction"><i class="alert alert-info"></i><span>doItemAction</span></a>
              </li>
              <li><a href="#button_switch"><i class="alert alert-info"></i><span>button_switch</span></a>
              </li>
              <li><a href="#get_form"><i class="alert alert-info"></i><span>get_form</span></a>
              </li>
              <li><a href="#get_list"><i class="alert alert-info"></i><span>get_list</span></a>
              </li>
              <li><a href="#get_wf"><i class="alert alert-info"></i><span>get_wf</span></a>
              </li>
              <li><a href="#isValidEmail"><i class="alert alert-info"></i><span>isValidEmail</span></a>
              </li>
              <li><a href="#isValidTCNo"><i class="alert alert-info"></i><span>isValidTCNo</span></a>
              </li>
              <li><a href="#isValidDate"><i class="alert alert-info"></i><span>isValidDate</span></a>
              </li>
              <li><a href="#pageData"><i class="alert alert-success"></i><span>pageData</span></a>
              </li>
              <li><a href="#pathDecider"><i class="alert alert-info"></i><span>pathDecider</span></a>
              </li>
              <li><a href="#redirectTo"><i class="alert alert-info"></i><span>redirectTo</span></a>
              </li>
              <li><a href="#dispatchClientCmd"><i class="alert alert-info"></i><span>dispatchClientCmd</span></a>
              </li>
              <li><a href="#get_diff"><i class="alert alert-info"></i><span>get_diff</span></a>
              </li>
              <li><a href="#get_diff_array"><i class="alert alert-info"></i><span>get_diff_array</span></a>
              </li>
              <li><a href="#item_from_array"><i class="alert alert-info"></i><span>item_from_array</span></a>
              </li>
              <li><a href="#submit"><i class="alert alert-info"></i><span>submit</span></a>
              </li>
              <li><a href="#convertDate"><i class="alert alert-info"></i><span>convertDate</span></a>
              </li>
            </ul>
          </div>
        </div>
        <div class="span9">
          <div class="description"></div>
          <div class="description"><p>The <code>formService</code> module  provides generic services for auto generated forms.</p></div>
          <pre><code class="language-javascript">angular.module('ulakbus.formService', ['ui.bootstrap'])</code></pre>
          <div class="description"><p>Moment.js used for date type conversions.<br />there must be no global object, so we change it into a service here.</p></div>
          <pre><code class="language-javascript">.service('Moment', function(){
    return window.moment;
})</code></pre>
          <div class="description"><p>form service&#39;s Generator factory service handles all generic form operations</p></div>
          <pre><code class="language-javascript">.factory('Generator', function ($http, $q, $timeout, $sce, $location, $route, $compile, $log, RESTURL, $rootScope, Moment) {
    var generator = {};</code></pre>
          <section id="makeUrl">
            <h1>makeUrl</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>generator.makeUrl()</span><span>&nbsp;</span>
            </p>
          </section>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>scope</td>
                <td></td>
                <td></td>
              </tr>
              <tr>
                <td>scope</td>
                <td></td>
                <td></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>this function generates url combining backend url and the related object properties for http requests</p></div>
          <pre><code class="language-javascript">generator.makeUrl = function (scope) {
    var getparams = scope.form_params.param ? &quot;?&quot; + scope.form_params.param + &quot;=&quot; + scope.form_params.id : &quot;&quot;;
    return RESTURL.url + scope.url + getparams;
};</code></pre>
          <section id="generate">
            <h1>generate</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>generator.generate()</span><span>&nbsp;</span>
            </p>
          </section>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>scope</td>
                <td></td>
                <td></td>
              </tr>
              <tr>
                <td>data</td>
                <td></td>
                <td></td>
              </tr>
              <tr>
                <td>scope</td>
                <td></td>
                <td></td>
              </tr>
              <tr>
                <td>data</td>
                <td></td>
                <td></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><ul>
<li>generate function is inclusive for form generation defines given scope&#39;s client_cmd, model, schema, form, token, object_id objects</li>
</ul>
</div>
          <pre><code class="language-javascript">generator.generate = function (scope, data) {

    // if no form in response (in case of list and single item request) return scope
    if (!data.forms) {
        return scope;
    }

    // prepare scope form, schema and model from response object
    angular.forEach(data.forms, function (value, key) {
        scope[key] = data.forms[key];
    });

    scope.client_cmd = data.client_cmd;

    scope.token = data.token;

    // initialModel will be used in formDiff when submiting the form to submit only
    scope.initialModel = angular.copy(scope.model);

    // if fieldset in form, make it collapsable with template
    //scope.listnodeform = {};
    //scope.isCollapsed = true;

    generator.prepareFormItems(scope);

    scope.object_id = scope.form_params.object_id;

    $log.debug('scope at after generate', scope);
    return scope;
};</code></pre>
          <section id="group">
            <h1>group</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>generator.group()</span><span>&nbsp;</span>
            </p>
          </section>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>scope</td>
                <td></td>
                <td></td>
              </tr>
              <tr>
                <td>scope</td>
                <td></td>
                <td></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>group function to group form layout by form meta data for layout grouping will use an object like example below when parsing its items.</p></div>
          <pre><code class="language-javascript">generator.group = function (scope) {

    if (!scope.grouping) {
        return scope;
    }

    var newForm = [];

    var extractFormItem = function (itemList) {
        var extractedList = [];
        angular.forEach(itemList, function (value, key) {
            var item = getFormItem(value);
            if (item) {
                extractedList.push(item);
            }
        });

        $log.debug('extractedList: ', extractedList);

        return extractedList;
    };

    var getFormItem = function (item) {
        var formItem;
        if (scope.form.indexOf(item) &gt; -1) {
            formItem = scope.form[scope.form.indexOf(item)];
            scope.form.splice(scope.form.indexOf(item), 1);
            return formItem;
        } else {
            angular.forEach(scope.form, function (value, key) {
                if (value.key === item) {
                    formItem = value;
                    scope.form.splice(key, 1);
                    return;
                }
            });
            return formItem;
        }
    };

    var makeGroup = function (itemsToGroup) {
        var subItems = [];
        angular.forEach(itemsToGroup, function (value, key) {
            subItems.push({
                type: 'fieldset',
                items: extractFormItem(value.items),
                title: value.group_title
            });
        });
        return subItems;
    };

    angular.forEach(scope.grouping, function (value, key) {
        newForm.push(
            {
                type: 'fieldset',
                items: makeGroup(value.groups),
                htmlClass: 'col-md-' + value.layout,
                title: value.group_title
            }
        )
    });

    $log.debug('grouped form: ', newForm);
    $log.debug('rest of form: ', scope.form);
    $log.debug('form united: ', newForm.concat(scope.form));

    scope.form = newForm.concat(scope.form);
    return scope;
};</code></pre>
          <section id="prepareFormItems">
            <h1>prepareFormItems</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>generator.prepareFormItems()</span><span>&nbsp;</span>
            </p>
          </section>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>scope</td>
                <td></td>
                <td><p>{Object} given scope on which form items prepared</p></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>It looks up fields of schema objects and changes their types to proper type for schemaform.<br />To prepare items for schemaform loop items of scope.schema.properties by checking index value&#39;s <code>type</code> key.</p><p>If <code>type</code> is in <code>[&#39;file&#39;, &#39;select&#39;, &#39;submit&#39;, &#39;date&#39;, &#39;int&#39;, &#39;text_general&#39;, &#39;model&#39;, &#39;ListNode&#39;, &#39;Node&#39;]</code><br />then the item must be converted into the data format which schemaform works with.</p><p>For listnode, node and model types it uses templates to generate modal. The modal is aa instance of<br />ui.bootstraps modal directive.</p></div>
          <pre><code class="language-javascript">generator.prepareFormItems = function (scope) {

    angular.forEach(scope.form, function (value, key) {
        if (value.type === 'select') {
            scope.schema.properties[value.key].type = 'select';
            scope.schema.properties[value.key].titleMap = value.titleMap;
            scope.form[key] = value.key;
        }
    });

    angular.forEach(scope.schema.properties, function (v, k) {

        // generically change _id fields model value
        if ('form_params' in scope) {
            if (k == scope.form_params.param) {
                scope.model[k] = scope.form_params.id;
                scope.form.splice(scope.form.indexOf(k), 1);
                return;
            }
        }

        if (v.type === 'file') {
            scope.form[scope.form.indexOf(k)] = {
                type: &quot;template&quot;,
                title: v.title,
                templateUrl: &quot;shared/templates/filefield.html&quot;,
                name: k,
                key: k,
                fileInsert: function () {
                    $scope.$broadcast('schemaForm.error.' + k, 'tv4-302', true);
                },
                imageSrc: scope.model[k] ? $rootScope.settings.static_url + scope.model[k] : '',
                avatar: k === 'avatar'
            };
            v.type = 'string';
        }

        if (v.type === 'select') {
            scope.form[scope.form.indexOf(k)] = {
                type: &quot;template&quot;,
                title: v.title,
                templateUrl: &quot;shared/templates/select.html&quot;,
                name: k,
                key: k,
                titleMap: v.titleMap
            };
        }

        if (v.type === 'submit' || v.type === 'button') {
            var buttonPositions = scope.modalElements ? scope.modalElements.buttonPositions : {
                bottom: 'move-to-bottom',
                top: 'move-to-top',
                none: ''
            };
            var workOnForm = scope.modalElements ? scope.modalElements.workOnForm : 'formgenerated';
            var workOnDiv = scope.modalElements ? scope.modalElements.workOnDiv : '';
            var buttonClass = (buttonPositions[v.position] || buttonPositions.bottom);
            var redirectTo = scope.modalElements ? false : true;

            scope.form[scope.form.indexOf(k)] = {
                type: v.type,
                title: v.title,
                style: &quot;btn-danger hide &quot; + buttonClass,
                onClick: function () {
                    delete scope.form_params.cmd;
                    delete scope.form_params.flow;
                    if (v.cmd) {
                        scope.form_params[&quot;cmd&quot;] = v.cmd;
                    }
                    if (v.flow) {
                        scope.form_params[&quot;flow&quot;] = v.flow;
                    }
                    if (v.wf) {
                        delete scope.form_params[&quot;cmd&quot;];
                        scope.form_params[&quot;wf&quot;] = v.wf;
                    }
                    scope.model[k] = 1;
                    // todo: test it
                    if (scope.modalElements) {
                        scope.submitModalForm();
                    } else {
                        if (v.validation === false) {
                            generator.submit(scope, redirectTo);
                        } else {
                            scope.$broadcast('schemaFormValidate');
                            if (scope[workOnForm].$valid) {
                                generator.submit(scope, redirectTo);
                                scope.$broadcast('disposeModal');
                            } else {
                                // focus to first input with validation error
                                $timeout(function () {
                                    var firsterror = angular.element(document.querySelectorAll('input.ng-invalid'))[0]
                                    firsterror.focus();
                                });
                            }
                        }
                    }
                }
            };
            // replace buttons according to their position values
            $timeout(function () {
                var selectorBottom = '.buttons-on-bottom' + workOnDiv;
                //var selectorTop = '.buttons-on-top'+workOnDiv;

                var buttonsToBottom = angular.element(document.querySelector('.' + buttonClass));
                angular.element(document.querySelector(selectorBottom)).append(buttonsToBottom);
                //var buttonsToTop = angular.element(document.querySelector('.' + buttonClass));
                //angular.element(document.querySelector(selectorTop)).append(buttonsToTop);

                buttonsToBottom.removeClass('hide');
                //buttonsToTop.removeClass('hide');
            }, 500);
        }

        // check if type is date and if type date found change it to string
        if (v.type === 'date') {
            $log.debug('date:', scope.model[k]);
            scope.model[k] = generator.dateformatter(scope.model[k]);
            scope.form[scope.form.indexOf(k)] = {
                key: k, name: k, title: v.title,
                type: 'template',
                templateUrl: 'shared/templates/datefield.html',
                validationMessage: {
                    'dateNotValid': &quot;Girdiğiniz tarih geçerli değildir. &lt;i&gt;orn: '01.01.2015'&lt;i/&gt;&quot;,
                    302: 'Bu alan zorunludur.'
                },
                $asyncValidators: {
                    'dateNotValid': function (value) {
                        var deferred = $q.defer();
                        $timeout(function () {
                            scope.model[k] = angular.copy(generator.dateformatter(value));
                            if (scope.schema.required.indexOf(k) &gt; -1) {
                                deferred.resolve();
                            }
                            if (value.constructor === Date) {
                                deferred.resolve();
                            }
                            else {
                                var dateValue = d = value.split('.');
                                if (isNaN(Date.parse(value)) || dateValue.length !== 3) {
                                    deferred.reject();
                                } else {
                                    deferred.resolve();
                                }
                            }
                        });
                        return deferred.promise;
                    }
                },
                status: {opened: false},
                open: function ($event) {
                    this.status.opened = true;
                },
                format: 'dd.MM.yyyy',
                onSelect: function () {
                    scope.model[k] = angular.copy(generator.dateformatter(scope.model[k]));
                }
            };
        }

        if (v.type === 'int' || v.type === 'float') {
            v.type = 'number';
            scope.model[k] = parseInt(scope.model[k]);
        }

        if (v.type === 'text_general') {
            v.type = 'string';
            v[&quot;x-schema-form&quot;] = {
                &quot;type&quot;: &quot;textarea&quot;
                //&quot;placeholder&quot;: &quot;&quot;
            }
        }

        // if type is model use foreignKey.html template to show them
        if (v.type === 'model') {

            var formitem = scope.form[scope.form.indexOf(k)];
            var modelScope = {&quot;url&quot;: v.wf, &quot;wf&quot;: v.wf, &quot;form_params&quot;: {model: v.model_name, cmd: v.list_cmd}};

            //scope.$on('refreshTitleMap', function (event, data) {
            // todo: write a function to refresh titleMap after new item add to linkedModel
            //});

            scope.generateTitleMap = function (modelScope) {
                return generator.get_list(modelScope).then(function (res) {
                    formitem.titleMap = [];
                    angular.forEach(res.data.objects, function (item) {
                        if (item !== -1) {
                            formitem.titleMap.push({
                                &quot;value&quot;: item.key,
                                &quot;name&quot;: item.value
                            });
                        } else {
                            formitem.focusToInput = true;
                        }
                    });

                    return formitem.titleMap;

                });
            };

            // get selected item from titleMap using model value
            if (scope.model[k]) {
                generator.get_list({
                        url: 'crud',
                        form_params: {model: v.model_name, object_id: scope.model[k], cmd: 'object_name'}
                    })
                    .then(function (data) {
                        try {
                            scope.$watch(document.querySelector('input[name=' + v.model_name + ']'),
                                function () {
                                    document.querySelector('input[name=' + k + ']').value = data.data.object_name;
                                }
                            );
                        }
                        catch (e) {
                            document.querySelector('input[name=' + k + ']').value = data.data.object_name;
                            $log.debug('exception', e);
                        }

                    });
            }

            formitem = {
                type: &quot;template&quot;,
                templateUrl: &quot;shared/templates/foreignKey.html&quot;,
                // formName will be used in modal return to save item on form
                formName: k,
                title: v.title,
                wf: v.wf,
                add_cmd: v.add_cmd,
                name: k,
                key: k,
                model_name: v.model_name,
                selected_item: {},
                titleMap: [],
                onSelect: function (item, inputname) {
                    scope.model[k] = item.value;
                    $timeout(function () {
                        document.querySelector('input[name=' + inputname + ']').value = item.name;
                    });
                },
                onDropdownSelect: function (item, inputname) {
                    scope.model[k] = item.value;
                    $timeout(function () {
                        document.querySelector('input[name=' + inputname + ']').value = item.name;
                    });
                },
                getTitleMap: function (viewValue) {
                    modelScope.form_params.query = viewValue;
                    return scope.generateTitleMap(modelScope);
                },
                getDropdownTitleMap: function () {
                    delete modelScope.form_params.query;
                    formitem.gettingTitleMap = true;
                    scope.generateTitleMap(modelScope)
                        .then(function (data) {
                            formitem.titleMap = data;
                            formitem.gettingTitleMap = false;
                        });


                }
            };

            scope.form[scope.form.indexOf(k)] = formitem;
        }

        if ((v.type === 'ListNode' || v.type === 'Node') &amp;&amp; v.widget === 'filter_interface') {
            var formitem = scope.form[scope.form.indexOf(k)];
            var modelScope = {
                &quot;url&quot;: v.wf || scope.wf, &quot;wf&quot;: v.wf || scope.wf,
                &quot;form_params&quot;: {model: v.model_name || v.schema[0].model_name, cmd: v.list_cmd || 'select_list', query: ''}
            };

            scope.generateTitleMap = function (modelScope) {
                generator.get_list(modelScope).then(function (res) {
                    formitem.titleMap = [];
                    angular.forEach(res.data.objects, function (item) {
                        if (item !== &quot;-1&quot;) {
                            formitem.titleMap.push({
                                &quot;value&quot;: item.key,
                                &quot;name&quot;: item.value
                            });
                        }
                    });
                    formitem.filteredItems = generator.get_diff_array(angular.copy(formitem.titleMap), angular.copy(formitem.selectedFilteredItems), 1);
                })
            };

            var modelItems = [];
            var modelKeys = [];
            angular.forEach(scope.model[k], function (value, mkey) {
                modelItems.push({
                    &quot;value&quot;: value[v.schema[0].name].key,
                    &quot;name&quot;: value[v.schema[0].name].unicode
                });
                var modelKey = {};
                modelKey[v.schema[0].name] = value[v.schema[0].name].key;
                modelKeys.push(modelKey);
            });
            scope.model[k] = angular.copy(modelKeys);

            formitem = {
                type: &quot;template&quot;,
                templateUrl: &quot;shared/templates/multiselect.html&quot;,
                title: v.title,
                // formName will be used in modal return to save item on form
                formName: k,
                wf: v.wf,
                add_cmd: v.add_cmd,
                name: v.model_name,
                model_name: v.model_name,
                filterValue: '',
                selected_item: {},
                filteredItems: [],
                selectedFilteredItems: modelItems,
                titleMap: scope.generateTitleMap(modelScope),
                appendFiltered: function (filterValue) {
                    if (filterValue.length &gt; 2) {
                        formitem.filteredItems = [];
                        angular.forEach(formitem.titleMap, function (value, key) {
                            if (value.name.indexOf(filterValue) &gt; -1) {
                                formitem.filteredItems.push(formitem.titleMap[key]);
                            }
                        });
                    }
                    if (filterValue &lt;= 2) { formitem.filteredItems = formitem.titleMap}
                    formitem.filteredItems = generator.get_diff_array(formitem.filteredItems, formitem.selectedFilteredItems);
                },
                select: function (selectedItemsModel) {
                    if (!selectedItemsModel) {
                        return;
                    }
                    formitem.selectedFilteredItems = formitem.selectedFilteredItems.concat(selectedItemsModel);
                    formitem.appendFiltered(formitem.filterValue);
                    scope.model[k] = (scope.model[k] || []).concat(formitem.dataToModel(selectedItemsModel));
                },
                deselect: function (selectedFilteredItemsModel) {
                    if (!selectedFilteredItemsModel) {
                        return;
                    }
                    formitem.selectedFilteredItems = generator.get_diff_array(angular.copy(formitem.selectedFilteredItems), angular.copy(selectedFilteredItemsModel));
                    formitem.appendFiltered(formitem.filterValue);
                    formitem.filteredItems = formitem.filteredItems.concat(selectedFilteredItemsModel);
                    scope.model[k] = generator.get_diff_array(scope.model[k] || [], formitem.dataToModel(selectedFilteredItemsModel));
                },
                dataToModel: function (data) {
                    var dataValues = [];
                    angular.forEach(data, function (value, key) {
                        var dataKey = {};
                        dataKey[v.schema[0].name] = value.value;
                        dataValues.push(dataKey);
                    });
                    return dataValues;
                }
            };

            scope.form[scope.form.indexOf(k)] = formitem;

        }

        if ((v.type === 'ListNode' || v.type === 'Node') &amp;&amp; v.widget !== 'filter_interface') {

            scope[v.type] = scope[v.type] || {};

            // no pass by reference
            scope[v.type][k] = angular.copy({
                title: v.title,
                form: [],
                schema: {
                    properties: {},
                    required: [],
                    title: v.title,
                    type: &quot;object&quot;,
                    formType: v.type,
                    model_name: k,
                    inline_edit: scope.inline_edit
                },
                url: scope.url,
                wf: scope.wf,
                nodeModelChange: function (item) {
                    //debugger;
                }

            });

            angular.forEach(v.schema, function (item) {
                scope[v.type][k].schema.properties[item.name] = angular.copy(item);

                // prepare required fields
                if (item.required === true &amp;&amp; item.name !== 'idx') {
                    scope[v.type][k].schema.required.push(angular.copy(item.name));
                }

                // idx field must be hidden
                if (item.name !== 'idx') {
                    scope[v.type][k].form.push(item.name);
                }

                try {
                    if (item.type === 'date') {
                        scope.model[k][item.name] = generator.dateformatter(scope.model[k][item.name]);
                    }
                } catch (e) {
                    $log.debug('Error: ', e.message);
                }


            });

            $timeout(function () {
                if (v.type === 'ListNode') {
                    scope[v.type][k].items = angular.copy(scope.model[k] || []);
                    angular.forEach(scope[v.type][k].items, function (value, key) {
                        if (value.constructor === Object) {
                            angular.forEach(value, function (x, y) {
                                try {
                                    if (scope[v.type][k].schema.properties[y].type === 'date') {
                                        scope[v.type][k].items[key][y] = generator.dateformatter(x);
                                        scope[v.type][k].model[key][y] = generator.dateformatter(x);
                                    }
                                    if (scope[v.type][k].schema.properties[y].type === 'select') {
                                        scope[v.type][k].items[key][y] = generator.item_from_array(x.toString(), scope[v.type][k].schema.properties[y].titleMap)
                                    }
                                } catch (e) {
                                    $log.debug('Field is not date');
                                }
                            });
                        }
                    });
                }
            });

            if (scope.model[k]) {
                angular.forEach(scope.model[k], function (value, key) {
                    angular.forEach(value, function (y, x) {
                        if (y.constructor === Object) {
                            scope.model[k][key][x] = y.key;
                        }
                    });
                });
            }

            scope.model[k] = scope.model[k] || [];

            scope[v.type][k].model = scope.model[k];

            // lengthModels is length of the listnode models. if greater than 0 show records on template
            scope[v.type][k]['lengthModels'] = scope.model[k] ? 1 : 0;

        }
    });

    $log.debug('scope at after prepareformitems', scope);
    return generator.group(scope);
};</code></pre>
          <section id="dateformatter">
            <h1>dateformatter</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>generator.dateformatter()</span><span>&nbsp;</span>
            </p>
          </section>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>formObject</td>
                <td>Object</td>
                <td></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>dateformatter handles all date fields and returns humanized and jquery datepicker format dates</p></div>
          <pre><code class="language-javascript">generator.dateformatter = function (formObject) {
    var ndate = new Date(formObject);
    if (isNaN(ndate)) {
        return '';
    } else {
        var newdatearray = Moment(ndate).format('DD.MM.YYYY');
        $log.debug('date formatted: ', newdatearray);
        return newdatearray;
    }
};</code></pre>
          <section id="doItemAction">
            <h1>doItemAction</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>generator.doItemAction()</span><span>&nbsp;</span>
            </p>
          </section>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>$scope</td>
                <td>Object</td>
                <td></td>
              </tr>
              <tr>
                <td>key</td>
                <td>string</td>
                <td></td>
              </tr>
              <tr>
                <td>todo</td>
                <td>Object</td>
                <td></td>
              </tr>
              <tr>
                <td>mode</td>
                <td>string</td>
                <td></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p><code>mode</code> could be in [&#39;normal&#39;, &#39;modal&#39;, &#39;new&#39;] . the default mode is &#39;normal&#39; and it loads data on same<br />tab without modal. &#39;modal&#39; will use modal to manipulate data and do all actions in that modal. &#39;new&#39;<br />will be open new page with response data</p></div>
          <pre><code class="language-javascript">generator.doItemAction = function ($scope, key, todo, mode) {
    var _do = {
        normal: function () {
            $log.debug('normal mode starts');
            $scope.form_params.cmd = todo.cmd;
            if (todo.wf) {
                $scope.url = todo.wf;
                $scope.form_params.wf = todo.wf;
                delete $scope.token;
                delete $scope.form_params.model;
                delete $scope.form_params.cmd
            }
            if (todo.object_key) {
                $scope.form_params[todo.object_key] = key;
            } else {
                $scope.form_params.object_id = key;
            }
            $scope.form_params.param = $scope.param;
            $scope.form_params.id = $scope.param_id;
            $scope.form_params.token = $scope.token;

            return generator.get_wf($scope);
        },
        modal: function () {
            $log.debug('modal mode is not not ready');
        },
        new: function () {
            $log.debug('new mode is not not ready');
        }
    };
    return _do[mode]();
};</code></pre>
          <section id="button_switch">
            <h1>button_switch</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>generator.button_switch()</span><span>&nbsp;</span>
            </p>
          </section>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>position</td>
                <td>boolean</td>
                <td></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>Changes html disabled and enabled attributes of all buttons on current page.</p></div>
          <pre><code class="language-javascript">generator.button_switch = function (position) {
    var buttons = angular.element(document.querySelectorAll('button'));
    var positions = {true: &quot;enabled&quot;, false: &quot;disabled&quot;};
    angular.forEach(buttons, function (button, key) {
        button[positions[position]] = true;
    });
    $log.debug('buttons &gt;&gt; ', positions[position])
}</code></pre>
          <section id="get_form">
            <h1>get_form</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>generator.get_form()</span><span>&nbsp;</span>
            </p>
          </section>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>scope</td>
                <td>Object</td>
                <td></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>Communicates with api with given scope object.</p></div>
          <pre><code class="language-javascript">generator.get_form = function (scope) {
    generator.button_switch(false);
    return $http
        .post(generator.makeUrl(scope), scope.form_params)
        .then(function (res) {
            generator.button_switch(true);
            return generator.generate(scope, res.data);
        });
};</code></pre>
          <section id="get_list">
            <h1>get_list</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>generator.get_list()</span><span>&nbsp;</span>
            </p>
          </section>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>scope</td>
                <td></td>
                <td></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>gets list of related wf/model</p></div>
          <pre><code class="language-javascript">generator.get_list = function (scope) {
    generator.button_switch(false);
    return $http
        .post(generator.makeUrl(scope), scope.form_params)
        .then(function (res) {
            generator.button_switch(true);
            return res;
        });
};</code></pre>
          <section id="get_wf">
            <h1>get_wf</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>generator.get_wf()</span><span>&nbsp;</span>
            </p>
          </section>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>scope</td>
                <td></td>
                <td></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>get_wf is the main function for client_cmd based api calls based on response content it redirects to related path/controller with pathDecider function</p></div>
          <pre><code class="language-javascript">generator.get_wf = function (scope) {
    generator.button_switch(false);
    return $http
        .post(generator.makeUrl(scope), scope.form_params)
        .then(function (res) {
            generator.button_switch(true);
            if (res.data.client_cmd) {
                return generator.pathDecider(res.data.client_cmd, scope, res.data);
            }
            if (res.data.msgbox) {
                scope.msgbox = res.data.msgbox;
                var newElement = $compile(&quot;&lt;msgbox&gt;&lt;/msgbox&gt;&quot;)(scope);
                // this is the default action, which is removing page items and reload page with msgbox
                angular.element(document.querySelector('.main.ng-scope')).children().remove();
                angular.element(document.querySelector('.main.ng-scope')).append(newElement);
            }
        });
};</code></pre>
          <section id="isValidEmail">
            <h1>isValidEmail</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>generator.isValidEmail()</span><span>&nbsp;</span>
            </p>
          </section>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>email</td>
                <td></td>
                <td></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>checks if given value is a valid email address.</p></div>
          <pre><code class="language-javascript">generator.isValidEmail = function (email) {
    var re = /^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;
    return re.test(email);
};</code></pre>
          <section id="isValidTCNo">
            <h1>isValidTCNo</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>generator.isValidTCNo()</span><span>&nbsp;</span>
            </p>
          </section>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>tcno</td>
                <td></td>
                <td></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>checks if given value is a valid identity number for Turkey.</p></div>
          <pre><code class="language-javascript">generator.isValidTCNo = function (tcno) {
    var re = /^([1-9]{1}[0-9]{9}[0,2,4,6,8]{1})$/i;
    return re.test(tcno);
};</code></pre>
          <section id="isValidDate">
            <h1>isValidDate</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>generator.isValidDate()</span><span>&nbsp;</span>
            </p>
          </section>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>dateValue</td>
                <td></td>
                <td></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>checks if given value can be parsed as Date object</p></div>
          <pre><code class="language-javascript">generator.isValidDate = function (dateValue) {
    return !isNaN(Date.parse(dateValue));
};</code></pre>
          <section id="pageData">
            <h1>pageData</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-success radius ctx-type">property</div><span>&nbsp;</span><span>generator.pageData</span><span>&nbsp;</span>
            </p>
          </section>
          <div class="description"><p>pageData object is moving object from response to controller with this object controller will not need to call the api for response object to work on to</p></div>
          <pre><code class="language-javascript">generator.pageData = {};
generator.getPageData = function () {
    return generator.pageData;
};
generator.setPageData = function (value) {
    generator.pageData = value;
};</code></pre>
          <section id="pathDecider">
            <h1>pathDecider</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>generator.pathDecider()</span><span>&nbsp;</span>
            </p>
          </section>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>client_cmd</td>
                <td>string</td>
                <td></td>
              </tr>
              <tr>
                <td>$scope</td>
                <td>Object</td>
                <td></td>
              </tr>
              <tr>
                <td>data</td>
                <td>Object</td>
                <td></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>pathDecider is used to redirect related path by looking up the data in response</p></div>
          <pre><code class="language-javascript">generator.pathDecider = function (client_cmd, $scope, data) {
    if (client_cmd[0] === 'reload' || client_cmd[0] === 'reset') {
        $rootScope.$broadcast('reload_cmd', $scope.reload_cmd);
        return;
    }</code></pre>
          <section id="redirectTo">
            <h1>redirectTo</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">function</div><span>&nbsp;</span><span>redirectTo()</span><span>&nbsp;</span>
            </p>
          </section>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>scope</td>
                <td>Object</td>
                <td></td>
              </tr>
              <tr>
                <td>page</td>
                <td>string</td>
                <td></td>
              </tr>
              <tr>
                <td>return</td>
                <td></td>
                <td></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>redirectTo function redirects to related controller and path with given data before redirect setPageData must be called and pageData need to be defined<br />otherwise redirected path will call api for its data</p></div>
          <pre><code class="language-javascript">function redirectTo(scope, page) {
    var pathUrl = '/' + scope.form_params.wf;
    if (scope.form_params.model) {
        pathUrl += '/' + scope.form_params.model + '/do/' + page;
    } else {
        pathUrl += '/do/' + page;
    }
    // todo add object url to path
    // pathUrl += '/'+scope.form_params.object_id || '';

    // if generated path url and the current path is equal route has to be reload
    if ($location.path() === pathUrl) {
        return $route.reload();
    }
    else {
        $location.path(pathUrl);
    }
}</code></pre>
          <section id="dispatchClientCmd">
            <h1>dispatchClientCmd</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">function</div><span>&nbsp;</span><span>dispatchClientCmd()</span><span>&nbsp;</span>
            </p>
          </section>
          <div class="description"><p>Sets params for scope to the related page and redirect to the page in client_cmd param. client_cmd can be in [&#39;list&#39;, &#39;form&#39;, &#39;show&#39;, &#39;reload&#39;, &#39;reset&#39;]</p></div>
          <pre><code class="language-javascript">function dispatchClientCmd() {
    data[$scope.form_params.param] = $scope.form_params.id;
    data['model'] = $scope.form_params.model;
    data['wf'] = $scope.form_params.wf;
    data['param'] = $scope.form_params.param;
    data['param_id'] = $scope.form_params.id;
    data['pageData'] = true;
    data['second_client_cmd'] = client_cmd[1];
    generator.setPageData(data);

    redirectTo($scope, client_cmd[0]);
}

dispatchClientCmd();
        };</code></pre>
          <section id="get_diff">
            <h1>get_diff</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>generator.get_diff()</span><span>&nbsp;</span>
            </p>
          </section>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>obj1</td>
                <td>Object</td>
                <td></td>
              </tr>
              <tr>
                <td>obj2</td>
                <td>Object</td>
                <td></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>returns diff of the second param to first param</p></div>
          <pre><code class="language-javascript">generator.get_diff = function (oldObj, newObj) {
    var result = {};
    angular.forEach(newObj, function (value, key) {
        if (oldObj[key]) {
            if ((oldObj[key].constructor === newObj[key].constructor) &amp;&amp; (newObj[key].constructor === Object || newObj[key].constructor === Array)) {
                angular.forEach(value, function (v, k) {
                    if (oldObj[key][k] != value[k]) {
                        result[key][k] = angular.copy(value[k]);
                    }
                });
            } else {
                if (oldObj[key] != newObj[key]) {
                    result[key] = angular.copy(newObj[key]);
                }
            }
        } else {
            result[key] = angular.copy(newObj[key]);
        }
    });
    return result;
};</code></pre>
          <section id="get_diff_array">
            <h1>get_diff_array</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>generator.get_diff_array()</span><span>&nbsp;</span>
            </p>
          </section>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>array1</td>
                <td>Array</td>
                <td></td>
              </tr>
              <tr>
                <td>array2</td>
                <td>Array</td>
                <td></td>
              </tr>
              <tr>
                <td>way</td>
                <td>Number</td>
                <td></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>extracts items of second array from the first array</p></div>
          <pre><code class="language-javascript">generator.get_diff_array = function (array1, array2, way) {
    var result = [];
    angular.forEach(array1, function (value, key) {
        if (way === 1) {
            if (angular.toJson(array2).indexOf(value.value) &lt; 0) {
                result.push(value);
            }
        } else {
            if (angular.toJson(array2).indexOf(angular.toJson(value)) &lt; 0) {
                result.push(value);
            }
        }
    });
    return result;
};</code></pre>
          <section id="item_from_array">
            <h1>item_from_array</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>generator.item_from_array()</span><span>&nbsp;</span>
            </p>
          </section>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>item</td>
                <td>Object</td>
                <td></td>
              </tr>
              <tr>
                <td>array</td>
                <td>Array</td>
                <td></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>gets item unicode name from titleMap</p></div>
          <pre><code class="language-javascript">generator.item_from_array = function (item, array) {
    var result = item;
    angular.forEach(array, function (value, key) {
        if (value.value === item) {
            result = value.name;
        }
    });
    return result;
};</code></pre>
          <section id="submit">
            <h1>submit</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">method</div><span>&nbsp;</span><span>generator.submit()</span><span>&nbsp;</span>
            </p>
          </section>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>$scope</td>
                <td>Object</td>
                <td></td>
              </tr>
              <tr>
                <td>redirectTo</td>
                <td>Object</td>
                <td></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>Submit function is generic function for submiting forms. - redirectTo param is used for redirect if return value will be evaluated in a new page.</p><ul>
<li>In case of unformatted date object in any key recursively, it must be converted by convertDate function.</li>
<li>ListNode and Node objects get seperated from model in<br />{@link prepareFormItems module:ulakbus.formService.function:prepareFormItems} They must be concat to model<br />key of scope first.</li>
<li>Backend API waits form as model value. So <code>data.form</code> key must be set to <code>$scope.model</code></li>
<li>Other parameters we pass to backend API are shown in the example below<pre><code>var data = {
              &quot;form&quot;: $scope.model,
              &quot;token&quot;: $scope.token,
              &quot;model&quot;: $scope.form_params.model,
              &quot;cmd&quot;: $scope.form_params.cmd,
              &quot;flow&quot;: $scope.form_params.flow,
              &quot;object_id&quot;: $scope.object_id,
              &quot;filter&quot;: $scope.filter,
              &quot;query&quot;: $scope.form_params.query
          };
</code></pre></li>
</ul>
<h2>Special response object process</h2>
<ul>
<li>If response object is a downloadable pdf file, checking from headers <code>headers(&#39;content-type&#39;) ===
&quot;application/pdf&quot;</code> download using Blob object.</li>
</ul>
</div>
          <pre><code class="language-javascript">generator.submit = function ($scope, redirectTo) {</code></pre>
          <section id="convertDate">
            <h1>convertDate</h1>
            <h5 class="subheader"></h5>
            <p>
              <div class="label label-info radius ctx-type">function</div><span>&nbsp;</span><span>convertDate()</span><span>&nbsp;</span>
            </p>
          </section>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>model</td>
                <td></td>
                <td></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>In case of unformatted date object in any key recursively, it must be converted.</p></div>
          <pre><code class="language-javascript">var convertDate = function (model) {
    angular.forEach(model, function (value, key) {
        if (value &amp;&amp; value.constructor === Date) {
            model[key] = generator.dateformatter(value);
        }
        if (value &amp;&amp; value.constructor === Object) {convertDate(value);}
    });
};

angular.forEach($scope.ListNode, function (value, key) {
    $scope.model[key] = value.model;
});
angular.forEach($scope.Node, function (value, key) {
    $scope.model[key] = value.model;
});
var data = {
    &quot;form&quot;: $scope.model,
    &quot;token&quot;: $scope.token,
    &quot;model&quot;: $scope.form_params.model,
    &quot;cmd&quot;: $scope.form_params.cmd,
    &quot;flow&quot;: $scope.form_params.flow,
    &quot;object_id&quot;: $scope.object_id,
    &quot;filter&quot;: $scope.filter,
    &quot;query&quot;: $scope.form_params.query
};

return $http.post(generator.makeUrl($scope), data)
    .success(function (data, status, headers) {
        if (headers('content-type') === &quot;application/pdf&quot;) {
            var a = document.createElement(&quot;a&quot;);
            document.body.appendChild(a);
            a.style = &quot;display: none&quot;;
            var file = new Blob([data], {type: 'application/pdf'});
            var fileURL = URL.createObjectURL(file);
            var fileName = $scope.schema.title;
            a.href = fileURL;
            a.download = fileName;
            a.click();
        }
        if (redirectTo === true) {
            if (data.client_cmd) {
                generator.pathDecider(data.client_cmd, $scope, data);
            }
            if (data.msgbox) {
                $scope.msgbox = data.msgbox;
                var newElement = $compile(&quot;&lt;msgbox&gt;&lt;/msgbox&gt;&quot;)($scope);
                // this is the default action, which is removing page items and reload page with msgbox
                angular.element(document.querySelector('.main.ng-scope')).children().remove();
                angular.element(document.querySelector('.main.ng-scope')).append(newElement);
            }
        }
    });
        };
        return generator;
    })</code></pre>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>items</td>
                <td>Object</td>
                <td></td>
              </tr>
              <tr>
                <td>$scope</td>
                <td>Object</td>
                <td></td>
              </tr>
              <tr>
                <td>$uibModalInstance</td>
                <td>Object</td>
                <td></td>
              </tr>
              <tr>
                <td>$route</td>
                <td>Object</td>
                <td></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>controller for listnode, node and linkedmodel modal and save data of it</p></div>
          <pre><code class="language-javascript">.controller('ModalCtrl', function ($scope, $uibModalInstance, Generator, items) {
    angular.forEach(items, function (value, key) {
        $scope[key] = items[key];
    });

    $scope.$on('disposeModal', function () {
        $scope.cancel();
    });

    $scope.$on('modalFormLocator', function (event) {
        $scope.linkedModelForm = event.targetScope.linkedModelForm;
    });

    $scope.$on('submitModalForm', function () {
        $scope.onSubmit($scope.linkedModelForm);
    });

    $scope.$on('validateModalDate', function (event, field) {
        $scope.$broadcast('schemaForm.error.' + field, 'tv4-302', true);
    });

    $scope.onSubmit = function (form) {
        $scope.$broadcast('schemaFormValidate');
        if (form.$valid) {
            // send form to modalinstance result function
            $uibModalInstance.close($scope);
        }
    };

    $scope.onNodeSubmit = function () {
        $scope.$broadcast('schemaFormValidate');
        if ($scope.modalForm.$valid) {
            $uibModalInstance.close($scope);
        }
    };

    $scope.cancel = function () {
        $uibModalInstance.dismiss('cancel');
    };
})</code></pre>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>$uibModal</td>
                <td>Module</td>
                <td></td>
              </tr>
              <tr>
                <td>Generator</td>
                <td>Service</td>
                <td></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>add modal directive for nodes</p></div>
          <pre><code class="language-javascript">.directive('modalForNodes', function ($uibModal, Generator) {
    return {
        link: function (scope, element, attributes) {
            element.on('click', function () {
                var modalInstance = $uibModal.open({
                    animation: true,
                    backdrop: 'static',
                    keyboard: false,
                    templateUrl: 'shared/templates/listnodeModalContent.html',
                    controller: 'ModalCtrl',
                    size: 'lg',
                    resolve: {
                        items: function () {
                            var attribs = attributes.modalForNodes.split(',');
                            // get node from parent scope catch with attribute
                            var node = angular.copy(scope.$parent[attribs[1]][attribs[0]]);

                            if (attribs[2] === 'add') {
                                node.model = {};
                            }

                            if (attribs[3]) {
                                // if listnode catch edit object with index
                                node.model = node.model[attribs[3]];
                            }

                            // tell result.then function which item to edit
                            node.edit = attribs[3];

                            scope.node.schema.wf = scope.node.url;

                            angular.forEach(scope.node.schema.properties, function (value, key) {
                                scope.node.schema.properties[key].wf = scope.node.url;
                                scope.node.schema.properties[key].list_cmd = 'select_list';
                            });

                            var newscope = {
                                wf: scope.node.wf,
                                url: scope.node.url,
                                form_params: {model: scope.node.schema.model_name},
                                edit: attribs[3]
                            };

                            Generator.generate(newscope, {forms: scope.node});
                            // modal will add only one item to listNode, so just need one model (not array)
                            newscope.model = newscope.model[node.edit] || newscope.model[0] || {};
                            return newscope;
                        }
                    }
                });

                modalInstance.result.then(function (childmodel, key) {

                    var listNodeItem = scope.$parent[childmodel.schema.formType][childmodel.schema.model_name];
                    if (childmodel.schema.formType === 'Node') {
                        listNodeItem.model = angular.copy(childmodel.model);
                        listNodeItem.lengthModels += 1;
                    }

                    if (childmodel.schema.formType === 'ListNode') {
                        // reformat listnode model
                        var reformattedModel = {};
                        angular.forEach(childmodel.model, function (value, key) {
                            if (key.indexOf('_id') &gt; -1) {
                                angular.forEach(childmodel.form, function (v, k) {
                                    if (v.formName === key) {
                                        //if (!childmodel.model[key].key) {
                                        function indexInTitleMap(element, index, array) {
                                            if (element['value'] === value) {
                                                return element;
                                            }
                                        }

                                        reformattedModel[key] = {
                                            &quot;key&quot;: value,
                                            &quot;unicode&quot;: v.titleMap.find(indexInTitleMap).name
                                        };
                                        //}
                                    }
                                });
                            } else {
                                reformattedModel[key] = {
                                    &quot;key&quot;: key,
                                    &quot;unicode&quot;: Generator.item_from_array(value, childmodel.schema.properties[key].titleMap)
                                };
                            }
                        });
                        if (childmodel.edit) {
                            listNodeItem.model[childmodel.edit] = childmodel.model;
                            if (Object.keys(reformattedModel).length &gt; 0) {
                                listNodeItem.items[childmodel.edit] = reformattedModel;
                            } else {
                                listNodeItem.items[childmodel.edit] = angular.copy(childmodel.model);
                            }
                        } else {
                            listNodeItem.model.push(angular.copy(childmodel.model));
                            if (Object.keys(reformattedModel).length &gt; 0) {
                                listNodeItem.items.push(reformattedModel);
                            } else {
                                listNodeItem.items.push(angular.copy(childmodel.model));
                            }
                        }
                        listNodeItem.lengthModels += 1;
                    }
                });
            });
        }
    };
})</code></pre>
          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th style="width:20%">Option name</th>
                <th style="width:20%">Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>$uibModal</td>
                <td>Module</td>
                <td></td>
              </tr>
              <tr>
                <td>$rootScope</td>
                <td>Object</td>
                <td></td>
              </tr>
              <tr>
                <td>$route</td>
                <td>Module</td>
                <td></td>
              </tr>
              <tr>
                <td>Generator</td>
                <td>Service</td>
                <td></td>
              </tr>
            </tbody>
          </table>
          <div class="description"><p>add modal directive for linked models</p></div>
          <pre><code class="language-javascript">.directive('addModalForLinkedModel', function ($uibModal, $rootScope, $route, Generator) {
    return {
        link: function (scope, element, attributes) {
            element.on('click', function () {
                var modalInstance = $uibModal.open({
                    animation: true,
                    backdrop: 'static',
                    keyboard: false,
                    templateUrl: 'shared/templates/linkedModelModalContent.html',
                    controller: 'ModalCtrl',
                    size: 'lg',
                    resolve: {
                        items: function () {
                            var formName = attributes.addModalForLinkedModel;
                            return Generator.get_form({
                                url: scope.form.wf,
                                wf: scope.form.wf,
                                form_params: {model: scope.form.model_name, cmd: scope.form.add_cmd},
                                modalElements: {
                                    // define button position properties
                                    buttonPositions: {
                                        bottom: 'move-to-bottom-modal',
                                        top: 'move-to-top-modal',
                                        none: ''
                                    },
                                    workOnForm: 'linkedModelForm',
                                    workOnDiv: '-modal' + formName
                                },
                                submitModalForm: function () {
                                    $rootScope.$broadcast('submitModalForm');
                                },
                                validateModalDate: function (field) {
                                    $rootScope.$broadcast('validateModalDate', field);
                                },
                                formName: formName
                            });
                        }
                    }
                });

                modalInstance.result.then(function (childscope, key) {
                    var formName = childscope.formName;
                    Generator.submit(childscope, false)
                        .success(function (data) {
                            // response data contains object_id and unicode
                            // scope.model can be reached via prototype chain
                            scope.model[formName] = data.forms.model.object_key;
                            // scope.form prototype chain returns this form item
                            scope.form.titleMap.push({
                                value: data.forms.model.object_key,
                                name: data.forms.model.unicode
                            });
                            scope.form.selected_item = {
                                value: data.forms.model.object_key,
                                name: data.forms.model.unicode
                            };
                            scope.$watch(document.querySelector('input[name=' + scope.form.model_name + ']'),
                                function () {
                                    angular.element(document.querySelector('input[name=' + scope.form.model_name + ']')).val(scope.form.selected_item.name);
                                }
                            );
                        });
                    //$route.reload();
                });
            });
        }
    };
})</code></pre>
          <div class="description"><p>This directive helps to locate form object in modal.</p></div>
          <pre><code class="language-javascript">.directive('modalFormLocator', function () {
    return {
        link: function (scope) {
            scope.$emit('modalFormLocator');
        }
    }
});</code></pre>
        </div>
      </div>
    </div>
    <footer class="footer">
      <div class="container">
        <p>Documentation generated with <a href="https://github.com/mr-doc/mr-doc">Mr. Doc </a> created by <a href="https://twitter.com/FGRibreau" data-show-count="false" class="twitter-follow-button">Francois-Guillaume Ribreau </a></p>
        <p>Mr. Doc is sponsored by <a href="http://bringr.net/?btt" title="Outil d'analyse des réseaux sociaux" class="bringr">Bringr </a> and <a href="https://redsmin.com/?btt" title="Full Redis GUI" class="redsmin">Redsmin</a></p>
        <p>Theme borrowed from Twitter Bootstrap</p>
      </div>
    </footer>
    <script src="js/twitter-widget.min.js"></script>
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap-transition.min.js"></script>
    <script src="js/bootstrap-scrollspy.min.js"></script>
    <script src="js/bootstrap-dropdown.min.js"></script>
    <script src="js/bootstrap-collapse.min.js"></script>
    <script src="js/bootstrap-affix.min.js"></script>
    <script src="js/prism.min.js"></script>
    <script src="js/index.min.js"></script>
  </body>
</html>